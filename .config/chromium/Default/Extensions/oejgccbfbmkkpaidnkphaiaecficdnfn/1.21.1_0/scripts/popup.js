!function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=6)}({2:function(e,t,s){"use strict";s.d(t,"a",function(){return r}),s.d(t,"b",function(){return n});var o=function(){},i=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.super=t.prototype},l=function(e,t,s){this.type=e,this.el=document.querySelector("#"+e+"-autocomplete"),this.filter=document.querySelector("#toggl-button-"+e+"-filter"),this.filterClear=this.el.parentNode.querySelector(".filter-clear"),this.placeholderItem=document.querySelector("#toggl-button-"+e+"-placeholder"),this.placeholderDiv=this.placeholderItem.querySelector("div"),this.clearSelected=this.el.querySelector("."+e+"-clear"),this.addLink=this.el.parentNode.querySelector(".add-new-"+e),this.elem=s,this.item=t,this.lastFilter="",this.listItems=[],this.exactMatch=!1,this.addEvents()};l.prototype.addEvents=function(){var e=this;e.placeholderItem.addEventListener("click",function(t){setTimeout(function(){e.filter.focus()},50)}),window.addEventListener("focus",function(t){t.target===e.filter&&e.openDropdown()},!0),e.filter.addEventListener("keydown",function(t){"Tab"===t.code&&e.closeDropdown(),"Enter"===t.code&&(e.filter.parentNode.classList.contains("open")&&e.saveSelected&&(e.saveSelected(),t.stopPropagation(),t.preventDefault()),e.closeDropdown()),"Escape"===t.code&&e.placeholderItem.parentNode.classList.contains("open")&&(e.closeDropdown(),t.stopPropagation(),t.preventDefault())}),e.filter.addEventListener("keyup",function(t){e.filterSelection()}),e.filterClear.addEventListener("click",function(t){e.closeDropdown(),t.preventDefault()})},l.prototype.clearFilters=function(){this.el.classList.remove("filtered");var e,t=this.el.querySelectorAll(".filter"),s=this.el.querySelectorAll(".tasklist-opened");for(e=0;e<t.length;e++)t[e].classList.remove("filter");for(e=0;e<s.length;e++)s[e].classList.remove("tasklist-opened")},l.prototype.openDropdown=function(){this.filter.parentNode.classList.add("open"),this.listItems=this.el.querySelectorAll(this.item),this.visibleItems=this.el.querySelectorAll("."+this.type+"-row"),this.updateHeight()},l.prototype.closeDropdown=function(e){var t=e||this;t.filter.value="",t.el.classList.remove("filtered"),t.placeholderItem.parentNode.classList.remove("open"),t.placeholderItem.parentNode.classList.remove("add-allowed"),t.clearFilters()},l.prototype.updateHeight=function(){var e,t=document.body.getBoundingClientRect(),s=this.el.getBoundingClientRect(),o="max-height:auto;",i="max-height:auto;";t.bottom>0&&s.bottom+25>=t.bottom&&((e=window.scrollY+t.bottom-s.top-10)<55&&(e=55),o="max-height: "+e+"px;",i="max-height: "+(e-25)+"px;"),this.el.style=o,"tag"===this.type&&(document.querySelector(".tag-list").style=i)};var r=function(e,t,s){l.call(this,e,t,s),this.onChangeHandler=o,this.selectedItem=-1,this.selectedTask=-1,this.visibleItems=[],this.visibleTasks=[]};i(r,l),r.prototype.setup=function(e,t){this.setSelected(e,t),this.placeholderDiv.textContent=this.placeholderDiv.title=this.generateLabel(null,e,this.type,t),this.setProjectBullet(e,t)},r.prototype.addEvents=function(){var e,t=this;this.super.addEvents.call(this),t.el.addEventListener("click",function(e){e.stopPropagation(),t.selectProject(e.target)}),t.filter.addEventListener("keydown",function(s){38===s.keyCode?t.selectPrevious():40===s.keyCode?t.selectNext():37!==s.keyCode&&39!==s.keyCode||(e=t.visibleItems[t.selectedItem]).querySelector(".task-count")&&(t.clearSelectedTask(),t.toggleTaskList(e.querySelector(".task-count")))})},r.prototype.clearSelectedItem=function(){var e=this.el.querySelector(".selected-item");e&&e.classList.remove("selected-item")},r.prototype.clearSelectedTask=function(){var e=this.el.querySelector(".task-item.selected-item");e&&e.classList.remove("selected-item")},r.prototype.selectPrevious=function(){if(-1!==this.selectedItem){if(-1!==this.selectedTask&&this.visibleItems[this.selectedItem].classList.contains("tasklist-opened")&&(this.clearSelectedTask(),this.selectedTask>0))return this.selectedTask--,this.visibleTasks[this.selectedTask].classList.add("selected-item"),void this.scrollUpToView(this.el,this.visibleTasks[this.selectedTask]);this.clearSelectedItem(),this.selectedItem>0?this.selectedItem--:this.selectedItem=this.visibleItems.length-1,this.visibleItems[this.selectedItem].classList.add("selected-item"),this.selectedItem===this.visibleItems.length-1&&this.visibleItems[this.selectedItem].scrollIntoView(!1),this.scrollUpToView(this.el,this.visibleItems[this.selectedItem]),this.visibleItems[this.selectedItem].classList.contains("tasklist-opened")&&(0===this.visibleTasks.length&&(this.visibleTasks=this.visibleItems[this.selectedItem].querySelectorAll("li.task-item")),this.selectedTask=this.visibleTasks.length-1,this.visibleTasks[this.selectedTask].classList.add("selected-item"),this.scrollUpToView(this.el,this.visibleTasks[this.selectedTask]))}},r.prototype.selectNext=function(){if(-1!==this.selectedItem&&this.visibleItems[this.selectedItem].classList.contains("tasklist-opened")){if(0===this.visibleTasks.length)return this.selectedTask=0,this.visibleTasks=this.visibleItems[this.selectedItem].querySelectorAll("li.task-item"),this.visibleTasks[this.selectedTask].classList.add("selected-item"),void this.scrollDownToView(this.el,this.visibleTasks[this.selectedTask]);if(this.clearSelectedTask(),this.selectedTask<this.visibleTasks.length-1)return this.selectedTask++,this.visibleTasks[this.selectedTask].classList.add("selected-item"),void this.scrollDownToView(this.el,this.visibleTasks[this.selectedTask])}this.selectedTask=-1,this.visibleTasks=[],this.clearSelectedItem(),this.selectedItem<this.visibleItems.length-1?this.selectedItem++:this.selectedItem=0,this.visibleItems[this.selectedItem].classList.add("selected-item"),0===this.selectedItem&&this.visibleItems[this.selectedItem].scrollIntoView(),this.scrollDownToView(this.el,this.visibleItems[this.selectedItem])},r.prototype.scrollDownToView=function(e,t){e.scrollTop+e.offsetHeight<t.offsetTop+t.offsetHeight&&t.scrollIntoView(!1)},r.prototype.scrollUpToView=function(e,t){e.scrollTop>t.offsetTop&&t.scrollIntoView()},r.prototype.saveSelected=function(){this.visibleTasks[this.selectedTask]?this.selectTask(this.visibleTasks[this.selectedTask]):this.visibleItems[this.selectedItem]&&this.selectProject(this.visibleItems[this.selectedItem]),this.closeDropdown()},r.prototype.setSelected=function(e,t){var s=this.el.querySelector("li[data-tid='"+t+"']");s?this.selectTask(s,!0):this.setSelectedProject(e)},r.prototype.setSelectedProject=function(e){var t,s=this.el.querySelectorAll(".selected-"+this.type);if(s.length>=1)for(t=0;t<s.length;t++)s[t].classList.remove("selected-"+this.type);e&&this.el.querySelector("li[data-pid='"+e+"']").classList.add("selected-"+this.type)},r.prototype.selectTask=function(e,t){var s=this.el.querySelector(".selected-task");s&&s.classList.remove("selected-task"),e.classList.add("selected-task"),this.selectProject(e.parentNode.parentNode,t,!0)},r.prototype.selectProject=function(e,t,s){if(e.classList.contains("item-name")&&(e=e.parentNode),!e.classList.contains(this.type+"-row"))return e.classList.contains("task-count")&&this.toggleTaskList(e),e.classList.contains("task-item")&&this.selectTask(e),void this.onChangeHandler(this.getSelected());!s&&this.el.querySelector(".selected-task")&&this.el.querySelector(".selected-task").classList.remove("selected-task");var o=this.el.querySelector(".selected-"+this.type),i=e.getAttribute("data-pid");return o&&o.classList.remove("selected-"+this.type),e.classList.add("selected-"+this.type),this.placeholderDiv.textContent=this.placeholderDiv.title=this.generateLabel(this.getSelected(),i,this.type),this.setProjectBullet(i),t||this.closeDropdown(),this.elem.updateBillable(parseInt(i,10)),this.onChangeHandler(this.getSelected()),!1},r.prototype.toggleTaskList=function(e){var t=this.el.querySelector(".tasklist-opened");t&&t.classList.remove("tasklist-opened"),t!==e.parentNode&&e.parentNode.classList.toggle("tasklist-opened")},r.prototype.getSelected=function(){var e=this.el.querySelector(".selected-"+this.type),t=this.el.querySelector(".selected-task");return{el:e,pid:e?parseInt(e.getAttribute("data-pid"),10):0,tid:t?parseInt(t.getAttribute("data-tid"),10):null,name:e?e.getAttribute("title"):""}},r.prototype.getSelectedProjectByPid=function(e){var t=this.el.querySelector("li[data-pid='"+e+"']");return{el:t,pid:e,name:t?t.textContent:""}},r.prototype.setProjectBullet=function(e,t,s){var o,i,l,r=s||this.placeholderItem.querySelector(".tb-project-bullet");return(e||"0"===e)&&(o=this.el.querySelector("li[data-pid='"+e+"']"))?(r.className=o.querySelector(".tb-project-bullet").className,r.setAttribute("style",o.querySelector(".tb-project-bullet").getAttribute("style")),i=" - "+o.getAttribute("title"),t&&(l=o.querySelector("li[data-tid='"+t+"']"))&&(i+=" . "+l.getAttribute("title")),i):(r.className="tb-project-bullet","")},r.prototype.generateLabel=function(e,t,s,o){var i,l,r=!1,n="";return(e=this.getSelectedProjectByPid(t))||(e=this.getSelected()),e&&e.el&&(r=e.pid,(l=e.el.querySelector(".selected-task")||e.el.querySelector("li[data-tid='"+o+"']"))&&(n+=l.getAttribute("title")+" . "),(i=e.el.parentNode.querySelector(".client-row"))&&(n=i.textContent+" - "),n+=e.el.getAttribute("title")),0!==parseInt(t,10)&&r?n:"Add "+s},r.prototype.filterSelection=function(){var e,t,s,o=this.filter.value.toLowerCase();if(this.updateHeight(),o!==this.lastFilter)if(o.length>0&&!this.el.classList.contains("filtered")&&this.el.classList.add("filtered"),0!==o.length){for(e in this.visibleItems=[this.el.querySelector("p."+this.type+"-row")],this.lastFilter=o,this.exactMatch=!1,this.listItems)this.listItems.hasOwnProperty(e)&&(-1!==(s=(t=this.listItems[e]).getAttribute("title").toLowerCase()).indexOf(o)?(s===o&&(this.exactMatch=o),this.visibleItems.push(t),t.classList.add("filter"),t.classList.contains("project-row")&&(t.parentNode.classList.add("filter"),t.parentNode.parentNode.classList.add("filter")),t.classList.contains("client-row")&&t.parentNode.classList.add("filter-match"),t.classList.contains("task-item")&&(t.parentNode.parentNode.classList.add("filter"),t.parentNode.parentNode.classList.add("tasklist-opened"),t.classList.add("filter"))):t.classList&&(t.classList.remove("filter"),t.classList.contains("task-item")?(t.classList.remove("filter"),0===t.parentNode.querySelectorAll(".filter").length&&t.parentNode.parentNode.classList.remove("tasklist-opened")):(0===t.parentNode.querySelectorAll(".filter").length&&t.parentNode.classList.remove("filter"),0===t.parentNode.parentNode.querySelectorAll(".filter").length&&t.parentNode.parentNode.classList.remove("filter"),t.classList.contains("client-row")&&(t.classList.remove("filter-match"),t.parentNode.classList.remove("filter-match"),t.parentNode.parentNode.classList.remove("filter-match")))));this.updateHeight()}else this.clearFilters()},r.prototype.closeDropdown=function(){this.super.closeDropdown(this,this),this.clearSelectedItem(),this.selectedItem=-1},r.prototype.onChange=function(e){this.onChangeHandler=e},r.prototype.removeChangeHandler=function(){this.onChangeHandler=o};var n=function(e,t,s){l.call(this,e,t,s),this.wid=null};i(n,l),n.prototype.setup=function(e,t){this.setSelected(e),this.setWorkspaceId(t)},n.prototype.addEvents=function(){var e=this;e.placeholderItem.addEventListener("click",function(t){setTimeout(function(){e.filter.focus()},50)}),window.addEventListener("focus",function(t){t.target===e.filter&&e.openDropdown()},!0),this.el.addEventListener("click",function(t){t.stopPropagation(),e.selectTag(t)}),this.filter.addEventListener("keyup",function(t){e.filterSelection()}),this.filter.addEventListener("keydown",function(t){"Tab"===t.code&&e.closeDropdown(),13===t.keyCode&&(t.preventDefault(),e.addNew()),27===t.keyCode&&(t.preventDefault(),e.closeDropdown())}),this.filterClear.addEventListener("click",function(t){e.closeDropdown(),t.preventDefault()}),this.clearSelected.addEventListener("click",function(t){e.clearSelectedTags()}),this.addLink.addEventListener("click",function(t){e.addNew()})},n.prototype.closeDropdown=function(){this.super.closeDropdown(this,this),this.updatePlaceholder()},n.prototype.selectTag=function(e){e.target.classList.toggle("selected-tag")},n.prototype.setSelected=function(e){var t,s;if(this.clearSelectedTags(),e)for(t=0;t<e.length;t+=1)(s=this.el.querySelector("li[title='"+e[t]+"']"))?s.classList.add("selected-"+this.type):this.addNew(e[t]);this.updatePlaceholder(e)},n.prototype.setWorkspaceId=function(e){this.wid=e;var t,s,o=this.el.querySelectorAll(this.item),i=e.toString();for(s in o)o.hasOwnProperty(s)&&((t=o[s]).dataset.wid===i||"nowid"===i?t.classList.remove("workspace-filter"):t.classList.add("workspace-filter"))},n.prototype.clearSelectedTags=function(e){var t,s=this.el.querySelectorAll(".tag-list li.selected-tag");for(t=0;t<s.length;t+=1)s[t].classList.remove("selected-tag")},n.prototype.updatePlaceholder=function(e){e||(e=this.getSelected()),e=e&&e.length?e.join(","):"Add tags",this.placeholderDiv.textContent=this.placeholderDiv.title=e},n.prototype.getSelected=function(){var e,t,s=[],o=this.el.querySelectorAll(".tag-list .selected-tag");for(t=0;t<o.length;t+=1)e=o[t].textContent,s.push(e);return s},n.prototype.filterSelection=function(){var e,t,s,o=this.filter.value.toLowerCase();if(o!==this.lastFilter)if(o.length>0&&!this.el.classList.contains("filtered")&&this.el.classList.add("filtered"),0!==o.length){for(e in this.lastFilter=o,this.exactMatch=!1,this.listItems)this.listItems.hasOwnProperty(e)&&(-1!==(s=(t=this.listItems[e]).getAttribute("title").toLowerCase()).indexOf(o)?(s===o&&(this.exactMatch=o),t.classList.add("filter")):t.classList&&t.classList.remove("filter"));this.updateAddLink()}else this.clearFilters()},n.prototype.updateAddLink=function(e){this.addLink&&(this.exactMatch?this.placeholderItem.parentNode.classList.remove("add-allowed"):this.placeholderItem.parentNode.classList.add("add-allowed"))},n.prototype.addNew=function(e){var t=e||this.filter.value,s=this.el.querySelector("."+this.type+"-list"),o=document.createElement("li");t&&(o.className=this.type+"-item selected-"+this.type,o.setAttribute("title",t),o.textContent=t,s.insertBefore(o,s.querySelector("li:first-child")),this.filter.value="",this.filterSelection())}},6:function(e,t,s){"use strict";s.r(t);var o=s(2);let i=chrome.extension.getBackgroundPage().TogglButton;-1===navigator.userAgent.indexOf("Chrome")&&document.querySelector("body").classList.add("ff"),window.PopUp={$postStartText:" post-start popup",$popUpButton:null,$togglButton:document.querySelector(".stop-button"),$resumeButton:document.querySelector(".resume-button"),$errorLabel:document.querySelector(".error"),$editButton:document.querySelector(".edit-button"),$tagIcon:document.querySelector(".tag-icon"),$projectBullet:document.querySelector(".timer .tb-project-bullet"),$projectAutocomplete:null,$tagAutocomplete:null,$timerRow:document.querySelector(".timer"),$timer:null,$tagsVisible:!1,mousedownTrigger:null,projectBlurTrigger:null,editFormAdded:!1,durationChanged:!1,$billable:null,$header:document.querySelector(".header"),$menuView:document.querySelector("#menu"),$editView:document.querySelector("#entry-form"),$loginView:document.querySelector("#login-form"),$revokedWorkspaceView:document.querySelector("#revoked-workspace"),$entries:document.querySelector(".entries-list"),defaultErrorMessage:"Error connecting to server",showPage:function(){let e,t;i||(i=chrome.extension.getBackgroundPage().TogglButton);try{null!==i.$user?(PopUp.editFormAdded||((t=document.createElement("div")).innerHTML=i.getEditForm(),PopUp.$editView.appendChild(t.firstChild),PopUp.addEditEvents(),PopUp.editFormAdded=!0),document.querySelector(".header .icon").setAttribute("title","Open toggl.com - "+i.$user.email),PopUp.$timerRow.classList.remove("has-resume"),null===i.$curEntry?(PopUp.$togglButton.setAttribute("data-event","timeEntry"),PopUp.$togglButton.textContent="Start new",PopUp.$togglButton.parentNode.classList.remove("tracking"),PopUp.$projectBullet.className="tb-project-bullet",i.$latestStoppedEntry&&(e=(e=i.findProjectByPid(i.$latestStoppedEntry.pid))?" - "+e.name:"",PopUp.$resumeButton.title=i.$latestStoppedEntry.description+e,PopUp.$timerRow.classList.add("has-resume"),localStorage.setItem("latestStoppedEntry",JSON.stringify(i.$latestStoppedEntry)),PopUp.$resumeButton.setAttribute("data-event","resume"))):(PopUp.$togglButton.setAttribute("data-event","stop"),PopUp.$togglButton.textContent="Stop",PopUp.$togglButton.parentNode.classList.add("tracking"),PopUp.showCurrentDuration(!0)),PopUp.$header.getAttribute("data-view")||PopUp.switchView(PopUp.$menuView),PopUp.renderEntriesList(),PopUp.renderSummary()):(localStorage.setItem("latestStoppedEntry",""),PopUp.switchView(PopUp.$loginView))}catch(e){chrome.runtime.sendMessage({type:"error",stack:e.stack,category:"Popup"})}},sendMessage:function(e){chrome.runtime.sendMessage(e,function(t){if(t){if("list-continue"===e.type&&!e.data&&!t.success)return PopUp.switchView(PopUp.$revokedWorkspaceView);if(t.success){if("create-workspace"===e.type)return PopUp.switchView(PopUp.$menuView);t.type&&"New Entry"===t.type&&Db.get("showPostPopup")?PopUp.updateEditForm(PopUp.$editView):"Update"===t.type?i=chrome.extension.getBackgroundPage().TogglButton:window.location.reload()}else("login"===e.type||t.type&&("New Entry"===t.type||"Update"===t.type))&&PopUp.showError(t.error||PopUp.defaultErrorMessage)}})},showError:function(e){PopUp.$errorLabel.textContent=e,PopUp.$errorLabel.classList.add("show"),setTimeout(function(){PopUp.$errorLabel.classList.remove("show")},3e3)},showCurrentDuration:function(e){if(null===i.$curEntry)return PopUp.$togglButton.setAttribute("data-event","timeEntry"),PopUp.$togglButton.setAttribute("title",""),PopUp.$togglButton.textContent="Start new",PopUp.$togglButton.parentNode.classList.remove("tracking"),clearInterval(PopUp.$timer),PopUp.$timer=null,void(PopUp.$projectBullet.className="tb-project-bullet");const t=PopUp.msToTime(new Date-new Date(i.$curEntry.start));let s=i.$curEntry.description||"(no description)";const o=document.querySelector("#toggl-button-duration");PopUp.$togglButton.textContent=t,o!==document.activeElement&&!1===PopUp.durationChanged?o.value=t:PopUp.durationChanged=!0,e&&(PopUp.$timer||(PopUp.$timer=setInterval(function(){PopUp.showCurrentDuration()},1e3)),s+=PopUp.$projectAutocomplete.setProjectBullet(i.$curEntry.pid,i.$curEntry.tid,PopUp.$projectBullet),PopUp.$editButton.textContent=s,PopUp.$editButton.setAttribute("title",'Click to edit "'+s+'"'),PopUp.setupIcons(i.$curEntry))},updateMenuTimer:function(e){let t=e.description||"(no description)";t+=PopUp.$projectAutocomplete.setProjectBullet(e.pid,e.tid,PopUp.$projectBullet),PopUp.$editButton.textContent=t,PopUp.$editButton.setAttribute("title",'Click to edit "'+t+'"'),PopUp.setTagIcon(e.tags)},renderSummary:function(){const e=i.calculateSums();document.querySelector(".summary .s-today > span").textContent=e.today,document.querySelector(".summary .s-week > span").textContent=e.week},renderEntriesList:function(){const e=document.createElement("div"),t=i.$user.time_entries,s=[];let o,l,r,n,c,a,d,p,u,h,m,g="",f=0;if(!t||t.length<1)return;const y=function(e,t){let s;if(t.length>0)for(s=0;s<t.length;s++)if(t[s].description===e.description&&t[s].pid===e.pid)return!1;return t.push(e),e},v=document.createElement("ul");for(m=t.length-1;m>=0&&!(f>=5);m--)(l=y(t[m],s))&&l.duration>=0&&(g="",(n=i.findProjectByPid(l.pid))?(c=n.name,a="background-color: "+n.hex_color+";",(n=document.createElement("div")).className="tb-project-bullet tb-project-color",n.setAttribute("style",a)):n=!1,o=(u=!!l.tags&&l.tags.length)?l.tags.join(", "):"",g=(u=u?"tag-icon-visible":"")+" "+(h=l.billable?"billable-icon-visible":""),(p=document.createElement("li")).setAttribute("data-id",m),(d=document.createElement("div")).className="te-desc",d.setAttribute("title",l.description),d.textContent=l.description||"(no description)",p.appendChild(d),(d=document.createElement("div")).className="te-proj",n&&(d.appendChild(n),d.appendChild(document.createTextNode(c))),p.appendChild(d),(d=document.createElement("div")).className="te-continue",d.textContent="Continue",p.appendChild(d),(d=document.createElement("div")).className="te-icons "+g,(r=document.createElement("div")).className="tag-icon",r.setAttribute("title",o),d.appendChild(r),(r=document.createElement("div")).className="billable-icon",r.setAttribute("title","billable"),d.appendChild(r),p.appendChild(d),v.appendChild(p),f++);if(0!==f){for((d=document.createElement("p")).textContent="Recent entries",d.addEventListener("click",e=>e.stopPropagation()),e.appendChild(d),e.appendChild(v);PopUp.$entries.firstChild;)PopUp.$entries.removeChild(PopUp.$entries.firstChild);PopUp.$entries.appendChild(e)}},setupIcons:function(e){PopUp.setTagIcon(e.tags),PopUp.setBillableIcon(!!e.billable)},setTagIcon:function(e){const t=!!e&&!!e.length,s=t?e.join(", "):"";PopUp.$timerRow.classList.toggle("tag-icon-visible",t),PopUp.$tagIcon.setAttribute("title",s)},setBillableIcon:function(e){PopUp.$timerRow.classList.toggle("billable-icon-visible",e)},switchView:function(e){PopUp.$header.setAttribute("data-view",e.id)},formatMe:function(e){return e<10?"0"+e:e},msToTime:function(e){let t=parseInt(e/1e3%60,10),s=parseInt(e/6e4%60,10),o=parseInt(e/36e5,10);return(o=o<10?"0"+o:o)+":"+(s=s<10?"0"+s:s)+":"+(t=t<10?"0"+t:t)},updateEditForm:function(e){const t=i.$curEntry.pid?i.$curEntry.pid:0,s=i.$curEntry.tid?i.$curEntry.tid:0,o=i.$curEntry.wid,l=document.querySelector("#toggl-button-description"),r=document.querySelector("#toggl-button-duration");l.value=i.$curEntry.description?i.$curEntry.description:"",r.value=PopUp.msToTime(new Date-new Date(i.$curEntry.start)),PopUp.$projectAutocomplete.setup(t,s),PopUp.$tagAutocomplete.setup(i.$curEntry.tags,o),PopUp.setupBillable(!!i.$curEntry.billable,t),PopUp.switchView(e),l.focus(),l.setSelectionRange(0,0),l.scrollLeft=0,PopUp.durationChanged=!1},updateBillable:function(e,t){let s,o,l=i.$user.default_wid;const r=i.$user.workspaces;let n;if(0===e)l=i.$user.default_wid;else{if(!(s=i.findProjectByPid(e)))return;l=s.wid}for(o=0;o<r.length;o++)if(r[o].id===l){n=r[o].premium;break}PopUp.toggleBillable(n),!t&&0!==e&&s.billable&&PopUp.$billable.classList.toggle("tb-checked",!0)},getStart:function(){const e=document.querySelector("#toggl-button-duration").value.split(":");if(!PopUp.isNumber(e.join("")))return!1;const t=1e3*(e[2]||0)+6e4*e[1]+36e5*e[0],s=new Date;return new Date(s.getTime()-t)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},toggleBillable:function(e){const t=e?"103":"-1";PopUp.$billable.setAttribute("tabindex",t),PopUp.$billable.classList.toggle("no-billable",!e)},setupBillable:function(e,t){PopUp.updateBillable(t,!0),PopUp.$billable.classList.toggle("tb-checked",e)},submitForm:function(e){if(!this.isformValid())return;const t=PopUp.$projectAutocomplete.getSelected(),s=!!document.querySelector(".tb-billable.tb-checked:not(.no-billable)"),o={type:"update",description:document.querySelector("#toggl-button-description").value,pid:t.pid,projectName:t.name,tags:PopUp.$tagAutocomplete.getSelected(),tid:t.tid,respond:!0,billable:s,service:"dropdown"},i=PopUp.getStart();i&&(o.start=i.toISOString(),o.duration=-1*Math.floor(i.getTime()/1e3)),PopUp.sendMessage(o),PopUp.updateMenuTimer(o),PopUp.switchView(PopUp.$menuView)},isformValid:function(){return!!document.querySelector("#toggl-button-edit-form form:valid")},addEditEvents:function(){PopUp.$projectAutocomplete=new o.a("project","li",PopUp),PopUp.$tagAutocomplete=new o.b("tag","li",PopUp),PopUp.$billable=document.querySelector(".tb-billable"),document.querySelector("#toggl-button-update").addEventListener("click",function(e){PopUp.submitForm(this)}),document.querySelector("#toggl-button-update").addEventListener("keydown",function(e){"Enter"!==e.code&&"Space"!==e.code||PopUp.submitForm(this)}),document.querySelector("#entry-form form").addEventListener("submit",function(e){PopUp.submitForm(this),e.preventDefault()}),PopUp.$projectAutocomplete.onChange(function(e){const t=i.findProjectByPid(e.pid),s=t?t.wid:i.$curEntry.wid;PopUp.$tagAutocomplete.setWorkspaceId(s)}),PopUp.$billable.addEventListener("click",function(){this.classList.toggle("tb-checked")}),PopUp.$billable.addEventListener("keydown",function(e){let t=!1;"Space"===e.code&&(t=!0,this.classList.toggle("tb-checked")),"ArrowLeft"===e.code&&(t=!0,this.classList.toggle("tb-checked",!1)),"ArrowRight"===e.code&&(t=!0,this.classList.toggle("tb-checked",!0)),t&&(e.stopPropagation(),e.preventDefault())})}},document.addEventListener("DOMContentLoaded",function(){let e;const t={type:"sync",respond:!1};try{PopUp.sendMessage(t),PopUp.showPage(),PopUp.$editButton.addEventListener("click",function(){PopUp.updateEditForm(PopUp.$editView)}),e=function(){const e={type:this.getAttribute("data-event"),respond:!0,service:"dropdown"};clearInterval(PopUp.$timer),PopUp.$timer=null,PopUp.sendMessage(e)},PopUp.$togglButton.addEventListener("click",e),PopUp.$resumeButton.addEventListener("click",e),document.querySelector(".header .cog").addEventListener("click",function(){chrome.runtime.sendMessage({type:"options",respond:!1})}),document.querySelector(".header .logout").addEventListener("click",function(){PopUp.sendMessage({type:"logout",respond:!0})}),document.querySelector(".header .sync").addEventListener("click",function(){PopUp.sendMessage({type:"sync",respond:!1}),window.close()}),document.querySelector("#signin").addEventListener("submit",function(e){e.preventDefault(),PopUp.$errorLabel.classList.remove("show");const t={type:"login",respond:!0,username:document.querySelector("#login_email").value,password:document.querySelector("#login_password").value};PopUp.sendMessage(t)}),document.querySelector("#workspace").addEventListener("submit",function(e){e.preventDefault();const t=document.querySelector("#workspace_name").value;if(!t)return PopUp.showError("Enter a workspace name");const s={type:"create-workspace",respond:!0,workspace:t};PopUp.sendMessage(s)}),document.querySelector(".header .icon").addEventListener("click",function(){chrome.tabs.create({url:"https://toggl.com/app"})}),PopUp.$entries.addEventListener("click",function(e){const t=e.target.closest("[data-id]").getAttribute("data-id"),s={type:"list-continue",respond:!0,service:"dropdown-list",data:i.$user.time_entries[t]};PopUp.sendMessage(s)})}catch(e){chrome.runtime.sendMessage({type:"error",stack:e.stack,category:"Popup"})}})}});