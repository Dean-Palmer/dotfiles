!function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=6)}({2:function(e,t,s){"use strict";s.d(t,"a",function(){return r}),s.d(t,"b",function(){return n});var i=function(){},o=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.super=t.prototype},l=function(e,t,s){this.type=e,this.el=document.querySelector("#"+e+"-autocomplete"),this.filter=document.querySelector("#toggl-button-"+e+"-filter"),this.filterClear=this.el.parentNode.querySelector(".filter-clear"),this.placeholderItem=document.querySelector("#toggl-button-"+e+"-placeholder"),this.placeholderDiv=this.placeholderItem.querySelector("div"),this.clearSelected=this.el.querySelector("."+e+"-clear"),this.addLink=this.el.parentNode.querySelector(".add-new-"+e),this.elem=s,this.item=t,this.lastFilter="",this.listItems=[],this.exactMatch=!1,this.addEvents()};l.prototype.addEvents=function(){var e=this;e.placeholderItem.addEventListener("click",function(t){setTimeout(function(){e.filter.focus()},50)}),window.addEventListener("focus",function(t){t.target===e.filter&&e.openDropdown()},!0),e.filter.addEventListener("keydown",function(t){"Tab"===t.code&&e.closeDropdown(),"Enter"===t.code&&(e.filter.parentNode.classList.contains("open")&&e.saveSelected&&(e.saveSelected(),t.stopPropagation(),t.preventDefault()),e.closeDropdown()),"Escape"===t.code&&e.placeholderItem.parentNode.classList.contains("open")&&(e.closeDropdown(),t.stopPropagation(),t.preventDefault())}),e.filter.addEventListener("keyup",function(t){e.filterSelection()}),e.filterClear.addEventListener("click",function(t){e.closeDropdown(),t.preventDefault()})},l.prototype.clearFilters=function(){this.el.classList.remove("filtered");var e,t=this.el.querySelectorAll(".filter"),s=this.el.querySelectorAll(".tasklist-opened");for(e=0;e<t.length;e++)t[e].classList.remove("filter");for(e=0;e<s.length;e++)s[e].classList.remove("tasklist-opened")},l.prototype.openDropdown=function(){this.filter.parentNode.classList.add("open"),this.listItems=this.el.querySelectorAll(this.item),this.visibleItems=this.el.querySelectorAll("."+this.type+"-row"),this.updateHeight()},l.prototype.closeDropdown=function(e){var t=e||this;t.filter.value="",t.el.classList.remove("filtered"),t.placeholderItem.parentNode.classList.remove("open"),t.placeholderItem.parentNode.classList.remove("add-allowed"),t.clearFilters()},l.prototype.updateHeight=function(){var e,t=document.body.getBoundingClientRect(),s=this.el.getBoundingClientRect(),i="max-height:auto;",o="max-height:auto;";t.bottom>0&&s.bottom+25>=t.bottom&&((e=window.scrollY+t.bottom-s.top-10)<55&&(e=55),i="max-height: "+e+"px;",o="max-height: "+(e-25)+"px;"),this.el.style=i,"tag"===this.type&&(document.querySelector(".tag-list").style=o)};var r=function(e,t,s){l.call(this,e,t,s),this.onChangeHandler=i,this.selectedItem=-1,this.selectedTask=-1,this.visibleItems=[],this.visibleTasks=[]};o(r,l),r.prototype.setup=function(e,t){this.setSelected(e,t),this.placeholderDiv.textContent=this.placeholderDiv.title=this.generateLabel(null,e,this.type,t),this.setProjectBullet(e,t)},r.prototype.addEvents=function(){var e,t=this;this.super.addEvents.call(this),t.el.addEventListener("click",function(e){e.stopPropagation(),t.selectProject(e.target)}),t.filter.addEventListener("keydown",function(s){38===s.keyCode?t.selectPrevious():40===s.keyCode?t.selectNext():37!==s.keyCode&&39!==s.keyCode||(e=t.visibleItems[t.selectedItem]).querySelector(".task-count")&&(t.clearSelectedTask(),t.toggleTaskList(e.querySelector(".task-count")))})},r.prototype.clearSelectedItem=function(){var e=this.el.querySelector(".selected-item");e&&e.classList.remove("selected-item")},r.prototype.clearSelectedTask=function(){var e=this.el.querySelector(".task-item.selected-item");e&&e.classList.remove("selected-item")},r.prototype.selectPrevious=function(){if(-1!==this.selectedItem){if(-1!==this.selectedTask&&this.visibleItems[this.selectedItem].classList.contains("tasklist-opened")&&(this.clearSelectedTask(),this.selectedTask>0))return this.selectedTask--,this.visibleTasks[this.selectedTask].classList.add("selected-item"),void this.scrollUpToView(this.el,this.visibleTasks[this.selectedTask]);this.clearSelectedItem(),this.selectedItem>0?this.selectedItem--:this.selectedItem=this.visibleItems.length-1,this.visibleItems[this.selectedItem].classList.add("selected-item"),this.selectedItem===this.visibleItems.length-1&&this.visibleItems[this.selectedItem].scrollIntoView(!1),this.scrollUpToView(this.el,this.visibleItems[this.selectedItem]),this.visibleItems[this.selectedItem].classList.contains("tasklist-opened")&&(0===this.visibleTasks.length&&(this.visibleTasks=this.visibleItems[this.selectedItem].querySelectorAll("li.task-item")),this.selectedTask=this.visibleTasks.length-1,this.visibleTasks[this.selectedTask].classList.add("selected-item"),this.scrollUpToView(this.el,this.visibleTasks[this.selectedTask]))}},r.prototype.selectNext=function(){if(-1!==this.selectedItem&&this.visibleItems[this.selectedItem].classList.contains("tasklist-opened")){if(0===this.visibleTasks.length)return this.selectedTask=0,this.visibleTasks=this.visibleItems[this.selectedItem].querySelectorAll("li.task-item"),this.visibleTasks[this.selectedTask].classList.add("selected-item"),void this.scrollDownToView(this.el,this.visibleTasks[this.selectedTask]);if(this.clearSelectedTask(),this.selectedTask<this.visibleTasks.length-1)return this.selectedTask++,this.visibleTasks[this.selectedTask].classList.add("selected-item"),void this.scrollDownToView(this.el,this.visibleTasks[this.selectedTask])}this.selectedTask=-1,this.visibleTasks=[],this.clearSelectedItem(),this.selectedItem<this.visibleItems.length-1?this.selectedItem++:this.selectedItem=0,this.visibleItems[this.selectedItem].classList.add("selected-item"),0===this.selectedItem&&this.visibleItems[this.selectedItem].scrollIntoView(),this.scrollDownToView(this.el,this.visibleItems[this.selectedItem])},r.prototype.scrollDownToView=function(e,t){e.scrollTop+e.offsetHeight<t.offsetTop+t.offsetHeight&&t.scrollIntoView(!1)},r.prototype.scrollUpToView=function(e,t){e.scrollTop>t.offsetTop&&t.scrollIntoView()},r.prototype.saveSelected=function(){this.visibleTasks[this.selectedTask]?this.selectTask(this.visibleTasks[this.selectedTask]):this.visibleItems[this.selectedItem]&&this.selectProject(this.visibleItems[this.selectedItem]),this.closeDropdown()},r.prototype.setSelected=function(e,t){var s=this.el.querySelector("li[data-tid='"+t+"']");s?this.selectTask(s,!0):this.setSelectedProject(e)},r.prototype.setSelectedProject=function(e){var t,s=this.el.querySelectorAll(".selected-"+this.type);if(s.length>=1)for(t=0;t<s.length;t++)s[t].classList.remove("selected-"+this.type);e&&this.el.querySelector("li[data-pid='"+e+"']").classList.add("selected-"+this.type)},r.prototype.selectTask=function(e,t){var s=this.el.querySelector(".selected-task");s&&s.classList.remove("selected-task"),e.classList.add("selected-task"),this.selectProject(e.parentNode.parentNode,t,!0)},r.prototype.selectProject=function(e,t,s){if(e.classList.contains("item-name")&&(e=e.parentNode),!e.classList.contains(this.type+"-row"))return e.classList.contains("task-count")&&this.toggleTaskList(e),e.classList.contains("task-item")&&this.selectTask(e),void this.onChangeHandler(this.getSelected());!s&&this.el.querySelector(".selected-task")&&this.el.querySelector(".selected-task").classList.remove("selected-task");var i=this.el.querySelector(".selected-"+this.type),o=e.getAttribute("data-pid");return i&&i.classList.remove("selected-"+this.type),e.classList.add("selected-"+this.type),this.placeholderDiv.textContent=this.placeholderDiv.title=this.generateLabel(this.getSelected(),o,this.type),this.setProjectBullet(o),t||this.closeDropdown(),this.elem.updateBillable(parseInt(o,10)),this.onChangeHandler(this.getSelected()),!1},r.prototype.toggleTaskList=function(e){var t=this.el.querySelector(".tasklist-opened");t&&t.classList.remove("tasklist-opened"),t!==e.parentNode&&e.parentNode.classList.toggle("tasklist-opened")},r.prototype.getSelected=function(){var e=this.el.querySelector(".selected-"+this.type),t=this.el.querySelector(".selected-task");return{el:e,pid:e?parseInt(e.getAttribute("data-pid"),10):0,tid:t?parseInt(t.getAttribute("data-tid"),10):null,name:e?e.getAttribute("title"):""}},r.prototype.getSelectedProjectByPid=function(e){var t=this.el.querySelector("li[data-pid='"+e+"']");return{el:t,pid:e,name:t?t.textContent:""}},r.prototype.setProjectBullet=function(e,t,s){var i,o,l,r=s||this.placeholderItem.querySelector(".tb-project-bullet");return(e||"0"===e)&&(i=this.el.querySelector("li[data-pid='"+e+"']"))?(r.className=i.querySelector(".tb-project-bullet").className,r.setAttribute("style",i.querySelector(".tb-project-bullet").getAttribute("style")),o=" - "+i.getAttribute("title"),t&&(l=i.querySelector("li[data-tid='"+t+"']"))&&(o+=" . "+l.getAttribute("title")),o):(r.className="tb-project-bullet","")},r.prototype.generateLabel=function(e,t,s,i){var o,l,r=!1,n="";return(e=this.getSelectedProjectByPid(t))||(e=this.getSelected()),e&&e.el&&(r=e.pid,(l=e.el.querySelector(".selected-task")||e.el.querySelector("li[data-tid='"+i+"']"))&&(n+=l.getAttribute("title")+" . "),(o=e.el.parentNode.querySelector(".client-row"))&&(n=o.textContent+" - "),n+=e.el.getAttribute("title")),0!==parseInt(t,10)&&r?n:"Add "+s},r.prototype.filterSelection=function(){var e,t,s,i=this.filter.value.toLowerCase();if(this.updateHeight(),i!==this.lastFilter)if(i.length>0&&!this.el.classList.contains("filtered")&&this.el.classList.add("filtered"),0!==i.length){for(e in this.visibleItems=[this.el.querySelector("p."+this.type+"-row")],this.lastFilter=i,this.exactMatch=!1,this.listItems)this.listItems.hasOwnProperty(e)&&(-1!==(s=(t=this.listItems[e]).getAttribute("title").toLowerCase()).indexOf(i)?(s===i&&(this.exactMatch=i),this.visibleItems.push(t),t.classList.add("filter"),t.classList.contains("project-row")&&(t.parentNode.classList.add("filter"),t.parentNode.parentNode.classList.add("filter")),t.classList.contains("client-row")&&t.parentNode.classList.add("filter-match"),t.classList.contains("task-item")&&(t.parentNode.parentNode.classList.add("filter"),t.parentNode.parentNode.classList.add("tasklist-opened"),t.classList.add("filter"))):t.classList&&(t.classList.remove("filter"),t.classList.contains("task-item")?(t.classList.remove("filter"),0===t.parentNode.querySelectorAll(".filter").length&&t.parentNode.parentNode.classList.remove("tasklist-opened")):(0===t.parentNode.querySelectorAll(".filter").length&&t.parentNode.classList.remove("filter"),0===t.parentNode.parentNode.querySelectorAll(".filter").length&&t.parentNode.parentNode.classList.remove("filter"),t.classList.contains("client-row")&&(t.classList.remove("filter-match"),t.parentNode.classList.remove("filter-match"),t.parentNode.parentNode.classList.remove("filter-match")))));this.updateHeight()}else this.clearFilters()},r.prototype.closeDropdown=function(){this.super.closeDropdown(this,this),this.clearSelectedItem(),this.selectedItem=-1},r.prototype.onChange=function(e){this.onChangeHandler=e},r.prototype.removeChangeHandler=function(){this.onChangeHandler=i};var n=function(e,t,s){l.call(this,e,t,s),this.wid=null};o(n,l),n.prototype.setup=function(e,t){this.setSelected(e),this.setWorkspaceId(t)},n.prototype.addEvents=function(){var e=this;this.super.addEvents.call(this),this.el.addEventListener("click",function(t){t.stopPropagation(),e.selectTag(t)}),this.clearSelected.addEventListener("click",function(t){e.clearSelectedTags()}),e.addLink.addEventListener("click",function(t){e.addNew()})},n.prototype.closeDropdown=function(){this.super.closeDropdown(this,this),this.updatePlaceholder()},n.prototype.selectTag=function(e){e.target.classList.toggle("selected-tag")},n.prototype.setSelected=function(e){var t,s;if(this.clearSelectedTags(),e)for(t=0;t<e.length;t+=1)(s=this.el.querySelector("li[title='"+e[t]+"']"))?s.classList.add("selected-"+this.type):this.addNew(e[t]);this.updatePlaceholder(e)},n.prototype.setWorkspaceId=function(e){this.wid=e;var t,s,i=this.el.querySelectorAll(this.item),o=e.toString();for(s in i)i.hasOwnProperty(s)&&((t=i[s]).dataset.wid===o||"nowid"===o?t.classList.remove("workspace-filter"):t.classList.add("workspace-filter"))},n.prototype.clearSelectedTags=function(e){var t,s=this.el.querySelectorAll(".tag-list li.selected-tag");for(t=0;t<s.length;t+=1)s[t].classList.remove("selected-tag")},n.prototype.updatePlaceholder=function(e){e||(e=this.getSelected()),e=e&&e.length?e.join(","):"Add tags",this.placeholderDiv.textContent=this.placeholderDiv.title=e},n.prototype.getSelected=function(){var e,t,s=[],i=this.el.querySelectorAll(".tag-list .selected-tag");for(t=0;t<i.length;t+=1)e=i[t].textContent,s.push(e);return s},n.prototype.filterSelection=function(){var e,t,s,i=this.filter.value.toLowerCase();if(i!==this.lastFilter)if(i.length>0&&!this.el.classList.contains("filtered")&&this.el.classList.add("filtered"),0!==i.length){for(e in this.lastFilter=i,this.exactMatch=!1,this.listItems)this.listItems.hasOwnProperty(e)&&(-1!==(s=(t=this.listItems[e]).getAttribute("title").toLowerCase()).indexOf(i)?(s===i&&(this.exactMatch=i),t.classList.add("filter")):t.classList&&t.classList.remove("filter"));this.updateAddLink()}else this.clearFilters()},n.prototype.updateAddLink=function(e){this.addLink&&(this.exactMatch?this.placeholderItem.parentNode.classList.remove("add-allowed"):this.placeholderItem.parentNode.classList.add("add-allowed"))},n.prototype.addNew=function(e){var t=e||this.filter.value,s=this.el.querySelector("."+this.type+"-list"),i=document.createElement("li");i.className=this.type+"-item selected-"+this.type,i.setAttribute("title",t),i.textContent=t,s.insertBefore(i,s.querySelector("li:first-child")),this.filter.value="",this.filterSelection()}},6:function(e,t,s){"use strict";s.r(t);var i=s(2),o=chrome.extension.getBackgroundPage().TogglButton;chrome.extension.getBackgroundPage().db;-1===navigator.userAgent.indexOf("Chrome")&&document.querySelector("body").classList.add("ff"),window.PopUp={$postStartText:" post-start popup",$popUpButton:null,$togglButton:document.querySelector(".stop-button"),$resumeButton:document.querySelector(".resume-button"),$errorLabel:document.querySelector(".error"),$editButton:document.querySelector(".edit-button"),$tagIcon:document.querySelector(".tag-icon"),$projectBullet:document.querySelector(".timer .tb-project-bullet"),$projectAutocomplete:null,$tagAutocomplete:null,$timerRow:document.querySelector(".timer"),$timer:null,$tagsVisible:!1,mousedownTrigger:null,projectBlurTrigger:null,editFormAdded:!1,durationChanged:!1,$billable:null,$header:document.querySelector(".header"),$menuView:document.querySelector("#menu"),$editView:document.querySelector("#entry-form"),$loginView:document.querySelector("#login-form"),$revokedWorkspaceView:document.querySelector("#revoked-workspace"),$entries:document.querySelector(".entries-list"),defaultErrorMessage:"Error connecting to server",showPage:function(){var e,t;o||(o=chrome.extension.getBackgroundPage().TogglButton);try{null!==o.$user?(PopUp.editFormAdded||((t=document.createElement("div")).innerHTML=o.getEditForm(),PopUp.$editView.appendChild(t.firstChild),PopUp.addEditEvents(),PopUp.editFormAdded=!0),document.querySelector(".header .icon").setAttribute("title","Open toggl.com - "+o.$user.email),PopUp.$timerRow.classList.remove("has-resume"),null===o.$curEntry?(PopUp.$togglButton.setAttribute("data-event","timeEntry"),PopUp.$togglButton.textContent="Start new",PopUp.$togglButton.parentNode.classList.remove("tracking"),PopUp.$projectBullet.className="tb-project-bullet",o.$latestStoppedEntry&&(e=(e=o.findProjectByPid(o.$latestStoppedEntry.pid))?" - "+e.name:"",PopUp.$resumeButton.title=o.$latestStoppedEntry.description+e,PopUp.$timerRow.classList.add("has-resume"),localStorage.setItem("latestStoppedEntry",JSON.stringify(o.$latestStoppedEntry)),PopUp.$resumeButton.setAttribute("data-event","resume"))):(PopUp.$togglButton.setAttribute("data-event","stop"),PopUp.$togglButton.textContent="Stop",PopUp.$togglButton.parentNode.classList.add("tracking"),PopUp.showCurrentDuration(!0)),PopUp.$header.getAttribute("data-view")||PopUp.switchView(PopUp.$menuView),PopUp.renderEntriesList(),PopUp.renderSummary()):(localStorage.setItem("latestStoppedEntry",""),PopUp.switchView(PopUp.$loginView))}catch(e){chrome.runtime.sendMessage({type:"error",stack:e.stack,category:"Popup"})}},sendMessage:function(e){chrome.runtime.sendMessage(e,function(t){if(t){if("list-continue"===e.type&&!e.data&&!t.success)return PopUp.switchView(PopUp.$revokedWorkspaceView);if(t.success){if("create-workspace"===e.type)return PopUp.switchView(PopUp.$menuView);t.type&&"New Entry"===t.type&&Db.get("showPostPopup")?PopUp.updateEditForm(PopUp.$editView):"Update"===t.type?o=chrome.extension.getBackgroundPage().TogglButton:window.location.reload()}else("login"===e.type||t.type&&("New Entry"===t.type||"Update"===t.type))&&PopUp.showError(t.error||PopUp.defaultErrorMessage)}})},showError:function(e){PopUp.$errorLabel.textContent=e,PopUp.$errorLabel.classList.add("show"),setTimeout(function(){PopUp.$errorLabel.classList.remove("show")},3e3)},showCurrentDuration:function(e){if(null===o.$curEntry)return PopUp.$togglButton.setAttribute("data-event","timeEntry"),PopUp.$togglButton.setAttribute("title",""),PopUp.$togglButton.textContent="Start new",PopUp.$togglButton.parentNode.classList.remove("tracking"),clearInterval(PopUp.$timer),PopUp.$timer=null,void(PopUp.$projectBullet.className="tb-project-bullet");var t=PopUp.msToTime(new Date-new Date(o.$curEntry.start)),s=o.$curEntry.description||"(no description)",i=document.querySelector("#toggl-button-duration");PopUp.$togglButton.textContent=t,i!==document.activeElement&&!1===PopUp.durationChanged?i.value=t:PopUp.durationChanged=!0,e&&(PopUp.$timer||(PopUp.$timer=setInterval(function(){PopUp.showCurrentDuration()},1e3)),s+=PopUp.$projectAutocomplete.setProjectBullet(o.$curEntry.pid,o.$curEntry.tid,PopUp.$projectBullet),PopUp.$editButton.textContent=s,PopUp.$editButton.setAttribute("title",'Click to edit "'+s+'"'),PopUp.setupIcons(o.$curEntry))},updateMenuTimer:function(e){var t=e.description||"(no description)";t+=PopUp.$projectAutocomplete.setProjectBullet(e.pid,e.tid,PopUp.$projectBullet),PopUp.$editButton.textContent=t,PopUp.$editButton.setAttribute("title",'Click to edit "'+t+'"'),PopUp.setTagIcon(e.tags)},renderSummary:function(){var e=o.calculateSums();document.querySelector(".summary .s-today > span").textContent=e.today,document.querySelector(".summary .s-week > span").textContent=e.week},renderEntriesList:function(){var e,t,s,i,l,r,n,c,a,d,p,u,h=document.createElement("div"),m=o.$user.time_entries,g=[],f="",y=0;if(m&&!(m.length<1)){for(u=function(e,t){var s;if(t.length>0)for(s=0;s<t.length;s++)if(t[s].description===e.description&&t[s].pid===e.pid)return!1;return t.push(e),e},c=document.createElement("ul"),p=m.length-1;p>=0&&!(y>=5);p--)(t=u(m[p],g))&&t.duration>=0&&(f="",(i=o.findProjectByPid(t.pid))?(l=i.name,r="background-color: "+i.hex_color+";",(i=document.createElement("div")).className="tb-project-bullet tb-project-color",i.setAttribute("style",r)):i=!1,e=(d=!!t.tags&&t.tags.length)?t.tags.join(", "):"",f=(d=d?"tag-icon-visible":"")+" "+(t.billable?"billable-icon-visible":""),(a=document.createElement("li")).setAttribute("data-id",p),(n=document.createElement("div")).className="te-desc",n.setAttribute("title",t.description),n.textContent=t.description||"(no description)",a.appendChild(n),(n=document.createElement("div")).className="te-proj",i&&(n.appendChild(i),n.appendChild(document.createTextNode(l))),a.appendChild(n),(n=document.createElement("div")).className="te-continue",n.textContent="Continue",a.appendChild(n),(n=document.createElement("div")).className="te-icons "+f,(s=document.createElement("div")).className="tag-icon",s.setAttribute("title",e),n.appendChild(s),(s=document.createElement("div")).className="billable-icon",s.setAttribute("title","billable"),n.appendChild(s),a.appendChild(n),c.appendChild(a),y++);if(0!==y){for((n=document.createElement("p")).textContent="Recent entries",n.addEventListener("click",e=>e.stopPropagation()),h.appendChild(n),h.appendChild(c);PopUp.$entries.firstChild;)PopUp.$entries.removeChild(PopUp.$entries.firstChild);PopUp.$entries.appendChild(h)}}},setupIcons:function(e){PopUp.setTagIcon(e.tags),PopUp.setBillableIcon(!!e.billable)},setTagIcon:function(e){var t=!!e&&!!e.length,s=t?e.join(", "):"";PopUp.$timerRow.classList.toggle("tag-icon-visible",t),PopUp.$tagIcon.setAttribute("title",s)},setBillableIcon:function(e){PopUp.$timerRow.classList.toggle("billable-icon-visible",e)},switchView:function(e){PopUp.$header.setAttribute("data-view",e.id)},formatMe:function(e){return e<10?"0"+e:e},msToTime:function(e){var t=parseInt(e/1e3%60,10),s=parseInt(e/6e4%60,10),i=parseInt(e/36e5,10);return(i=i<10?"0"+i:i)+":"+(s=s<10?"0"+s:s)+":"+(t=t<10?"0"+t:t)},updateEditForm:function(e){var t=o.$curEntry.pid?o.$curEntry.pid:0,s=o.$curEntry.tid?o.$curEntry.tid:0,i=o.$curEntry.wid,l=document.querySelector("#toggl-button-description"),r=document.querySelector("#toggl-button-duration");l.value=o.$curEntry.description?o.$curEntry.description:"",r.value=PopUp.msToTime(new Date-new Date(o.$curEntry.start)),PopUp.$projectAutocomplete.setup(t,s),PopUp.$tagAutocomplete.setup(o.$curEntry.tags,i),PopUp.setupBillable(!!o.$curEntry.billable,t),PopUp.switchView(e),l.focus(),l.setSelectionRange(0,0),l.scrollLeft=0,PopUp.durationChanged=!1},updateBillable:function(e,t){var s,i,l,r=o.$user.default_wid,n=o.$user.workspaces;if(0===e)r=o.$user.default_wid;else{if(!(s=o.findProjectByPid(e)))return;r=s.wid}for(i=0;i<n.length;i++)if(n[i].id===r){l=n[i].premium;break}PopUp.toggleBillable(l),!t&&0!==e&&s.billable&&PopUp.$billable.classList.toggle("tb-checked",!0)},getStart:function(){var e,t,s=document.querySelector("#toggl-button-duration").value.split(":");return!!PopUp.isNumber(s.join(""))&&(e=1e3*(s[2]||0)+6e4*s[1]+36e5*s[0],t=new Date,new Date(t.getTime()-e))},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},toggleBillable:function(e){var t=e?"103":"-1";PopUp.$billable.setAttribute("tabindex",t),PopUp.$billable.classList.toggle("no-billable",!e)},setupBillable:function(e,t){PopUp.updateBillable(t,!0),PopUp.$billable.classList.toggle("tb-checked",e)},submitForm:function(e){if(this.isformValid()){var t=PopUp.$projectAutocomplete.getSelected(),s=!!document.querySelector(".tb-billable.tb-checked:not(.no-billable)"),i={type:"update",description:document.querySelector("#toggl-button-description").value,pid:t.pid,projectName:t.name,tags:PopUp.$tagAutocomplete.getSelected(),tid:t.tid,respond:!0,billable:s,service:"dropdown"},o=PopUp.getStart();o&&(i.start=o.toISOString(),i.duration=-1*Math.floor(o.getTime()/1e3)),PopUp.sendMessage(i),PopUp.updateMenuTimer(i),PopUp.switchView(PopUp.$menuView)}},isformValid:function(){return!!document.querySelector("#toggl-button-edit-form form:valid")},addEditEvents:function(){PopUp.$projectAutocomplete=new i.a("project","li",PopUp),PopUp.$tagAutocomplete=new i.b("tag","li",PopUp),PopUp.$billable=document.querySelector(".tb-billable"),document.querySelector("#toggl-button-update").addEventListener("click",function(e){PopUp.submitForm(this)}),document.querySelector("#toggl-button-update").addEventListener("keydown",function(e){"Enter"!==e.code&&"Space"!==e.code||PopUp.submitForm(this)}),document.querySelector("#entry-form form").addEventListener("submit",function(e){PopUp.submitForm(this),e.preventDefault()}),PopUp.$projectAutocomplete.onChange(function(e){var t=o.findProjectByPid(e.pid),s=t?t.wid:o.$curEntry.wid;PopUp.$tagAutocomplete.setWorkspaceId(s)}),PopUp.$billable.addEventListener("click",function(){this.classList.toggle("tb-checked")}),PopUp.$billable.addEventListener("keydown",function(e){var t=!1;"Space"===e.code&&(t=!0,this.classList.toggle("tb-checked")),"ArrowLeft"===e.code&&(t=!0,this.classList.toggle("tb-checked",!1)),"ArrowRight"===e.code&&(t=!0,this.classList.toggle("tb-checked",!0)),t&&(e.stopPropagation(),e.preventDefault())})}},document.addEventListener("DOMContentLoaded",function(){var e;try{PopUp.sendMessage({type:"sync",respond:!1}),PopUp.showPage(),PopUp.$editButton.addEventListener("click",function(){PopUp.updateEditForm(PopUp.$editView)}),e=function(){var e={type:this.getAttribute("data-event"),respond:!0,service:"dropdown"};clearInterval(PopUp.$timer),PopUp.$timer=null,PopUp.sendMessage(e)},PopUp.$togglButton.addEventListener("click",e),PopUp.$resumeButton.addEventListener("click",e),document.querySelector(".header .cog").addEventListener("click",function(){chrome.runtime.sendMessage({type:"options",respond:!1})}),document.querySelector(".header .logout").addEventListener("click",function(){PopUp.sendMessage({type:"logout",respond:!0})}),document.querySelector(".header .sync").addEventListener("click",function(){PopUp.sendMessage({type:"sync",respond:!1}),window.close()}),document.querySelector("#signin").addEventListener("submit",function(e){e.preventDefault(),PopUp.$errorLabel.classList.remove("show");var t={type:"login",respond:!0,username:document.querySelector("#login_email").value,password:document.querySelector("#login_password").value};PopUp.sendMessage(t)}),document.querySelector("#workspace").addEventListener("submit",function(e){e.preventDefault();const t=document.querySelector("#workspace_name").value;if(!t)return PopUp.showError("Enter a workspace name");const s={type:"create-workspace",respond:!0,workspace:t};PopUp.sendMessage(s)}),document.querySelector(".header .icon").addEventListener("click",function(){chrome.tabs.create({url:"https://toggl.com/app"})}),PopUp.$entries.addEventListener("click",function(e){const t=e.target.closest("[data-id]").getAttribute("data-id");var s={type:"list-continue",respond:!0,service:"dropdown-list",data:o.$user.time_entries[t]};PopUp.sendMessage(s)})}catch(e){chrome.runtime.sendMessage({type:"error",stack:e.stack,category:"Popup"})}})}});