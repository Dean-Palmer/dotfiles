var INITIAL_VALUE_ATTRIBUTE="com.onepassword.iv";function isFirefox(){return false}function ag_focusField(field,preserveValue){if(!field){return false}let previousValue=field.value;if(typeof field.click==="function"){field.click()}if(typeof field.focus==="function"){field.focus()}if(preserveValue&&field.value!==previousValue){field.value=previousValue}return typeof field.click==="function"||typeof field.focus==="function"}function firePreSetValueEvents(element){var elementValue=element.value;ag_focusField(element,false);element.dispatchEvent(createKeyboardEvent(element,"keydown",0,0));element.dispatchEvent(createKeyboardEvent(element,"keypress",0,0));element.dispatchEvent(createKeyboardEvent(element,"keyup",0,0));if(element.value===""||element.dataset[INITIAL_VALUE_ATTRIBUTE]&&element.value===element.dataset[INITIAL_VALUE_ATTRIBUTE]){element.value=elementValue}}function firePostSetValueEvents(element){var elementValue=element.value;var change=element.ownerDocument.createEvent("HTMLEvents");var input=element.ownerDocument.createEvent("HTMLEvents");element.dispatchEvent(createKeyboardEvent(element,"keydown",0,0));element.dispatchEvent(createKeyboardEvent(element,"keypress",0,0));element.dispatchEvent(createKeyboardEvent(element,"keyup",0,0));input.initEvent("input",true,true);element.dispatchEvent(input);change.initEvent("change",true,true);element.dispatchEvent(change);element.blur();if(element.value===""||element.dataset[INITIAL_VALUE_ATTRIBUTE]&&element.value===element.dataset[INITIAL_VALUE_ATTRIBUTE]){element.value=elementValue}const backgroundColor=luminance(...getColor(element))<.5?"light":"dark";element.setAttribute("data-com-onepassword-filled",backgroundColor)}function createKeyboardEvent(element,eventName,keyCode,charCode){let kEvent;if(isFirefox()){kEvent=document.createEvent("KeyboardEvent");kEvent.initKeyEvent(eventName,true,false,null,false,false,false,false,keyCode,charCode)}else{kEvent=element.ownerDocument.createEvent("Events");kEvent.initEvent(eventName,true,false);kEvent.charCode=charCode;kEvent.keyCode=keyCode;kEvent.which=keyCode;kEvent.srcElement=element;kEvent.target=element}return kEvent}function getColor(el){const rgbColor=window.getComputedStyle(el).color;if(!rgbColor||!rgbColor.startsWith("rgb")){return[0,0,0]}const components=rgbColor.match(/\d+/g);if(!components||components.length<3){return[0,0,0]}return components.map(Number)}function luminance(r,g,b){return(.2126*r+.7152*g+.0722*b)/255}(async function(tab){let fillables=document.querySelectorAll("input, select, button");let filledCount=0;let tick=()=>{return new Promise(resolve=>{setTimeout(()=>{resolve()},1)})};let opidFromString=function(opidStr){if(!opidStr||opidStr.length<3)return-1;return parseInt(opidStr.substr(2))};let fillByOPID=function(opid,value){let field=fillables[opidFromString(opid)];if(!field){return}if(field.type==="checkbox"){let enabled=!!value;if(field.checked!=enabled){field.click()}}else{firePreSetValueEvents(field);field.value=value;firePostSetValueEvents(field)}filledCount++};let performOperation=function(op){if(op.action==="fopid"){fillByOPID(op.values[0],op.values[1])}else if(op.action==="fq"){let query=op.values[0];let value=op.values[1];let el=document.querySelector(query);if(el&&el.value!==undefined){firePreSetValueEvents(el);el.value=value;firePostSetValueEvents(el);filledCount++}}else if(op.action==="copid"){let opid=opidFromString(op.values[0]);if(fillables[opid]){let field=fillables[opid];if(typeof field.click==="function"){field.click()}filledCount++}}else if(op.action==="focusopid"){let opid=opidFromString(op.values[0]);if(fillables[opid]){let field=fillables[opid];ag_focusField(field,true)}}};let executeFS=async function(fillScript){if(!fillScript.script){return-1}for(let i=0;i<fillScript.script.length;i++){let op=fillScript.script[i];performOperation(op);await tick()}const data={postFill:"FocusLastFilledField"};if(fillScript.metadata&&fillScript.metadata.postFill){data.postFill=fillScript.metadata.postFill}if(fillScript.autosubmit){performOperation(fillScript.autosubmit);await tick()}chrome.runtime.sendMessage({name:"fill-script-complete",data:data});return filledCount};if(requestUUID!==tab.uuid){return null}if(tab.allowedDomains){let hostname=window.location.hostname;let allowed=tab.allowedDomains.find(allowed=>{return allowed===hostname||hostname.endsWith("."+allowed)});if(!allowed){return null}}for(let i=0;i<tab.scripts.length;i++){let script=tab.scripts[i];if(script.documentUUID!==documentUUID||!script.script||script.script.length===0)continue;if(tab.requireHTTPS&&window.location.protocol!=="https:"){let confirmResult=confirm("1Password warning: This is an unsecured (HTTP) page, and any information you submit can potentially be "+"seen and changed by others. This Login was originally saved on a secure (HTTPS) page.\r\n\r\nDo you still wish to fill this login?");if(!confirmResult){return null}}await executeFS(script);return null}return null});